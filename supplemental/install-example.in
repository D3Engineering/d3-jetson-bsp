#!/usr/bin/env bash

TEGRA_DIR='/usr/lib/aarch64-linux-gnu/tegra'
GST_DIR='/usr/lib/aarch64-linux-gnu/gstreamer-1.0'

JETPACK_SUF='@JP_VERSION@'
LOCAL_SUF='@D3_JETSON_BSP_VERSION@-@CUSTOMER@'

[ "$UID" != "0" ] && echo "This requires root privileges"


##
# Installs binary files while retaining backups of the source and
# destination files.
#
# @param 1 destination directory
#
# <stdin> a listing of files to update. All files must exist in $PWD
install-files()
{
    local dest_dir="$1"
    local saved_dir="$PWD"

    cd "$dest_dir"
    while read f; do
        # backup Jetpack file
        local backup_file="${f}-${JETPACK_SUF}"
        if ! [ -e "$backup_file" ]; then
            cp "${f}" "$backup_file"
            sha256sum "$backup_file"
        fi

        # backup patched file
        local install_file="${f}-${LOCAL_SUF}"
        if ! [ -e "$install_file" ]; then
            cp "${saved_dir}/${f}" "$install_file"
            sha256sum "$install_file"
        fi

        # use the patched file
        cp "$install_file" "$f"
        sha256sum "$f"
    done
    cd "$saved_dir"
}



main()
{
    install-files "$TEGRA_DIR" <<EOF
libnvargus.so
libnvargus_socketclient.so
libnvargus_socketserver.so
EOF

}

main



